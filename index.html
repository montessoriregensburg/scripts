<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Pr√ºfungsvorbereitung Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root {
  --accent: #ff2d2d;
  --bg: #0f0f0f;
  --card: #1e1e1e;
  --text: #fff;
  --font: "Arial", sans-serif;
  --fontsize: 15px;
}
body {
  margin:0;
  font-family: var(--font);
  font-size: var(--fontsize);
  background: var(--bg);
  color: var(--text);
  padding:20px;
  padding-bottom:220px;
  transition: all 0.3s;
}
h1 { margin-bottom:10px; }
.update { background: var(--accent); color:#000; padding:12px; border-radius:12px; margin-bottom:15px; font-weight:bold; text-align:center; }
input, select, button { padding:10px; border-radius:10px; border:none; font-size: var(--fontsize); transition: all 0.3s; }
button { cursor:pointer; font-weight:bold; background: var(--accent); color:#000; transition: all 0.3s; }
.tags { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
.tag { background:#2a2a2a; padding:6px 14px; border-radius:20px; cursor:pointer; transition: all 0.3s; }
.tag.active { background: var(--accent); color:#000; }
.file { background: var(--card); padding:15px; border-radius:14px; margin-bottom:25px; transition: all 0.3s; overflow:hidden; }
.file strong { font-size:18px; display:block; margin-bottom:5px; }
.file .info { font-size:13px; color:#aaa; margin-bottom:8px; }
.file .buttons { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; align-items:center; }
.file .buttons a, .file .buttons button { text-decoration:none; padding:8px 14px; border-radius:10px; font-weight:bold; cursor:pointer; transition: all 0.3s; }
.file .buttons a.view { background:#333; color:#fff; }
.file .buttons a.download { background: var(--accent); color:#000; }
.file .checkbox { margin-left:10px; cursor:pointer; }
#adminPanel { display:none; margin-top:20px; background:#1a1a1a; padding:15px; border-radius:12px; }

/* Vorschau-Frames */
.preview-frame { 
  width:100%; 
  height:450px; 
  border-radius:12px; 
  border:none; 
  margin-top:10px; 
  display: none;
}
.preview-frame.show { 
  display: block; 
}

/* MP3 Player */
.audio-player {
  background: #2a2a2a;
  border-radius: 12px;
  padding: 15px;
  margin-top: 10px;
  display: none;
}
.audio-player.show {
  display: block;
}
.audio-player audio {
  width: 100%;
  margin-bottom: 10px;
}
.player-controls {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}
.play-btn, .pause-btn {
  background: var(--accent);
  color: #000;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
.time-display {
  font-size: 12px;
  color: #aaa;
}
.volume-slider {
  width: 100px;
}

/* Settings Panel */
#settingsPanel { margin-bottom:20px; background:#1a1a1a; padding:15px; border-radius:12px; display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:10px; align-items:center; }
#settingsPanel label { display:flex; flex-direction:column; font-size:12px; }
#settingsPanel select, #settingsPanel input { margin-top:5px; }

/* Sticky Bottom Bar */
.sticky { position:fixed; bottom:0; left:0; width:100%; background:#141414; padding:15px; border-top:2px solid var(--accent); display:flex; justify-content:space-around; flex-wrap:wrap; gap:10px; z-index:999; }
.sticky button { flex:1 0 120px; transition: all 0.3s; }

table { width:100%; border-collapse:collapse; margin-top:15px; border-radius:10px; overflow:hidden; }
th, td { padding:10px; border:1px solid var(--accent); text-align:left; }
th { background:var(--accent); color:#000; }

/* Filter-Buttons */
.filter-buttons {
  display: flex;
  gap: 10px;
  margin: 15px 0;
  flex-wrap: wrap;
}
.filter-btn {
  background: #333;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
}
.filter-btn.active {
  background: var(--accent);
  color: #000;
}
</style>
</head>
<body>

<div id="settingsPanel">
  <label>Hintergrund <input type="color" id="bgColor" value="#0f0f0f"></label>
  <label>Textfarbe <input type="color" id="textColor" value="#ffffff"></label>
  <label>Akzentfarbe <input type="color" id="accentColor" value="#ff2d2d"></label>
  <label>Schriftart 
    <select id="fontSelect">
      <option value="Arial, sans-serif">Arial</option>
      <option value="Verdana, sans-serif">Verdana</option>
      <option value="Courier New, monospace">Courier New</option>
      <option value="Georgia, serif">Georgia</option>
    </select>
  </label>
  <label>Schriftgr√∂√üe <input type="number" id="fontSize" value="15" min="10" max="30">px</label>
  <label>Voreingestelltes Design
    <select id="presetDesigns">
      <option value="0">Standard (Dunkel/Rot)</option>
      <option value="1">Hell/Blau</option>
      <option value="2">Gr√ºn/Schwarz</option>
      <option value="3">Violett/Dunkel</option>
      <option value="4">Orange/Hell</option>
      <option value="5">Neon/Schwarz</option>
    </select>
  </label>
  <button onclick="toggleTheme()">Dark/Light</button>
</div>

<div class="update">üîî Version 0.6 + MP3 Player</div>

<h1>üìÇ Pr√ºfungsvorbereitung</h1>
<p id="stats">üìä Downloads gesamt: 512</p>

<input id="search" placeholder="üîç Datei suchen ‚Ä¶">

<div class="filter-buttons">
  <button class="filter-btn active" onclick="filterByType('all')">Alle</button>
  <button class="filter-btn" onclick="filterByType('pdf')">üìÑ PDF</button>
  <button class="filter-btn" onclick="filterByType('doc')">üìù Dokumente</button>
  <button class="filter-btn" onclick="filterByType('slides')">üìä Pr√§sentationen</button>
  <button class="filter-btn" onclick="filterByType('mp3')">üéµ Audio</button>
</div>
  <button class="filter-btn" onclick="filterByType('youtube')">üé¨ YouTube</button>
</div>

<button onclick="toggleAllPreviews()" style="margin-bottom:20px;">üëÅÔ∏è Alle Vorschauen an/aus</button>

<div class="tags" id="tagContainer"></div>

<div id="fileList"></div>

<hr>

<button onclick="login()">Admin Login</button>
<button onclick="logout()">Logout</button>

<div id="adminPanel">
<h3>‚ûï Neue Datei hinzuf√ºgen</h3>
<input id="fname" placeholder="Dateiname">
<input id="gid" placeholder="Google Drive Link oder YouTube ID">
<select id="ftype">
  <option value="doc">Textdokument</option>
  <option value="slides">Pr√§sentation</option>
  <option value="pdf">PDF</option>
  <option value="mp3">Audio (MP3)</option>
  <option value="youtube">YouTube Video</option>
</select>
<input id="ftags" placeholder="Tags durch Komma trennen">
<label style="display:flex; align-items:center; gap:10px; margin-top:10px;">
  <input type="checkbox" id="fpreview"> Vorschau aktivieren
</label>
<button onclick="addFile()">‚ûï Datei hinzuf√ºgen</button>

<h3>üìã Alle Dateien als Tabelle anzeigen</h3>
<button onclick="showTable()">Tabelle erstellen</button>
<div id="fileTableContainer"></div>

<h3>üíæ Daten als CSV exportieren</h3>
<button onclick="exportCSV()">CSV exportieren</button>
</div>

<h3>‚ö†Ô∏è Lokale Daten</h3>
<button style="background:#ff5555;color:#000"
        onclick="deleteAllLocalFiles()">
üóëÔ∏è Alle lokal gespeicherten Dateien l√∂schen
</button>


<div class="sticky">
  <button onclick="alert('ZIP-Download (Server n√∂tig)')">üì¶ ZIP-Download</button>
  <button onclick="login()">üîí Admin</button>
  <button onclick="window.scrollTo({top:0, behavior:'smooth'})">‚¨ÜÔ∏è Top</button>
</div>

<script>
// Admin Login
const ADMIN_USER="admin", ADMIN_PASS="1234";

// Presets
const presets=[
  {name:"Standard Dunkel/Rot", bg:"#0f0f0f", text:"#ffffff", accent:"#ff2d2d", font:"Arial, sans-serif", fsize:15},
  {name:"Hell/Blau", bg:"#f0f0f0", text:"#000000", accent:"#3498db", font:"Verdana, sans-serif", fsize:15},
  {name:"Gr√ºn/Schwarz", bg:"#001f00", text:"#ffffff", accent:"#2ecc71", font:"Georgia, serif", fsize:16},
  {name:"Violett/Dunkel", bg:"#1a001a", text:"#ffffff", accent:"#9b59b6", font:"Courier New, monospace", fsize:16},
  {name:"Orange/Hell", bg:"#fff8f0", text:"#333333", accent:"#e67e22", font:"Arial, sans-serif", fsize:15},
  {name:"Neon/Schwarz", bg:"#000000", text:"#39ff14", accent:"#ff00ff", font:"Verdana, sans-serif", fsize:16}
];

// Style Live Anwenden
function applyStyle(bg, text, accent, font, fsize){
  document.documentElement.style.setProperty("--bg", bg);
  document.documentElement.style.setProperty("--text", text);
  document.documentElement.style.setProperty("--accent", accent);
  document.body.style.fontFamily = font;
  document.body.style.fontSize = fsize+"px";
  document.getElementById("bgColor").value = bg;
  document.getElementById("textColor").value = text;
  document.getElementById("accentColor").value = accent;
  document.getElementById("fontSelect").value = font;
  document.getElementById("fontSize").value = fsize;
  localStorage.setItem("bgColor", bg);
  localStorage.setItem("textColor", text);
  localStorage.setItem("accentColor", accent);
  localStorage.setItem("fontFamily", font);
  localStorage.setItem("fontSize", fsize);
}

// Inputs live
document.getElementById("bgColor").oninput=e=>applyStyle(e.target.value, document.getElementById("textColor").value, document.getElementById("accentColor").value, document.getElementById("fontSelect").value, document.getElementById("fontSize").value);
document.getElementById("textColor").oninput=e=>applyStyle(document.getElementById("bgColor").value,e.target.value,document.getElementById("accentColor").value,document.getElementById("fontSelect").value,document.getElementById("fontSize").value);
document.getElementById("accentColor").oninput=e=>applyStyle(document.getElementById("bgColor").value,document.getElementById("textColor").value,e.target.value,document.getElementById("fontSelect").value,document.getElementById("fontSize").value);
document.getElementById("fontSelect").onchange=e=>applyStyle(document.getElementById("bgColor").value,document.getElementById("textColor").value,document.getElementById("accentColor").value,e.target.value,document.getElementById("fontSize").value);
document.getElementById("fontSize").oninput=e=>applyStyle(document.getElementById("bgColor").value,document.getElementById("textColor").value,document.getElementById("accentColor").value,document.getElementById("fontSelect").value,e.target.value);

// Preset
document.getElementById("presetDesigns").onchange=e=>{
  const p=presets[e.target.value];
  applyStyle(p.bg,p.text,p.accent,p.font,p.fsize);
}

// Dark/Light Toggle
function toggleTheme(){
  const currentBg=getComputedStyle(document.documentElement).getPropertyValue("--bg").trim();
  if(currentBg==="#0f0f0f"){ applyStyle("#ffffff","#000000","#3498db","Verdana, sans-serif",15); document.getElementById("presetDesigns").value="1"; }
  else{ applyStyle("#0f0f0f","#ffffff","#ff2d2d","Arial, sans-serif",15); document.getElementById("presetDesigns").value="0"; }
}

// Lade Style
function loadStyle(){
  applyStyle(localStorage.getItem("bgColor")||presets[0].bg,
             localStorage.getItem("textColor")||presets[0].text,
             localStorage.getItem("accentColor")||presets[0].accent,
             localStorage.getItem("fontFamily")||presets[0].font,
             localStorage.getItem("fontSize")||presets[0].fsize);
}
loadStyle();

// Vorschau umschalten
function togglePreview(button, fileId) {
  const container = button.parentElement.parentElement;
  const previewFrame = container.querySelector('.preview-frame');
  const audioPlayer = container.querySelector('.audio-player');
  
  if (previewFrame) {
    previewFrame.classList.toggle('show');
    button.textContent = previewFrame.classList.contains('show') ? 'üëÅÔ∏è Vorschau verstecken' : 'üëÅÔ∏è Vorschau zeigen';
  }
  
  if (audioPlayer) {
    audioPlayer.classList.toggle('show');
    button.textContent = audioPlayer.classList.contains('show') ? 'üéµ Player verstecken' : 'üéµ Player anzeigen';
    
    // Wenn Player geschlossen wird, pausiere Audio
    if (!audioPlayer.classList.contains('show')) {
      const audio = audioPlayer.querySelector('audio');
      if (audio) {
        audio.pause();
        const playBtn = audioPlayer.querySelector('.play-btn');
        if (playBtn) playBtn.textContent = '‚ñ∂Ô∏è Abspielen';
      }
    }
  }
}

// Alle Vorschauen umschalten
function toggleAllPreviews() {
  const frames = document.querySelectorAll('.preview-frame');
  const players = document.querySelectorAll('.audio-player');
  const buttons = document.querySelectorAll('.preview-btn');
  
  const allElements = [...frames, ...players];
  if (allElements.length === 0) return;
  
  const showAll = !allElements[0].classList.contains('show');
  
  allElements.forEach(element => {
    if (showAll) {
      element.classList.add('show');
    } else {
      element.classList.remove('show');
      // Audio pausieren wenn geschlossen
      if (element.classList.contains('audio-player')) {
        const audio = element.querySelector('audio');
        if (audio) audio.pause();
      }
    }
  });
  
  buttons.forEach(btn => {
    const container = btn.parentElement.parentElement;
    const hasPreview = container.querySelector('.preview-frame') || container.querySelector('.audio-player');
    if (hasPreview) {
      btn.textContent = showAll ? 
        (container.querySelector('.audio-player') ? 'üéµ Player verstecken' : 'üëÅÔ∏è Vorschau verstecken') : 
        (container.querySelector('.audio-player') ? 'üéµ Player anzeigen' : 'üëÅÔ∏è Vorschau zeigen');
    }
  });
}

// Audio Player Funktionen
function toggleAudio(button) {
  const audio = button.parentElement.querySelector('audio');
  if (audio.paused) {
    audio.play();
    button.textContent = '‚è∏Ô∏è Pause';
  } else {
    audio.pause();
    button.textContent = '‚ñ∂Ô∏è Abspielen';
  }
}

function updateTime(audioElement) {
  const container = audioElement.closest('.audio-player');
  const timeDisplay = container.querySelector('.time-display');
  if (timeDisplay) {
    const current = formatTime(audioElement.currentTime);
    const duration = formatTime(audioElement.duration || 0);
    timeDisplay.textContent = `${current} / ${duration}`;
  }
}

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
}

function changeVolume(slider, audioId) {
  const audio = document.getElementById(audioId);
  if (audio) audio.volume = slider.value;
}

// Filter nach Dateityp
function filterByType(type) {
  // Filter-Buttons aktualisieren
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Dateien filtern
  const files = document.querySelectorAll('.file');
  files.forEach(file => {
    const fileType = file.dataset.type || '';
    if (type === 'all' || fileType === type) {
      file.style.display = 'block';
    } else {
      file.style.display = 'none';
    }
  });
}

// Dateien
let defaultFiles=[
  {name:"Impuls 1 - Potenzen und Wurzeln", type:"pdf", googleId:"1K3fuoW8fUEJKSF40SV1prjVcgiEYk9Q-", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 2 - Potenzen und Wurzeln", type:"pdf", googleId:"1jQPdxk7zcjjqKNGCtMIwA0GF-V0WigUA", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 3 - Potenzen und Wurzeln", type:"pdf", googleId:"1sbbDAcAOrREqA4ygLzgSBPBlNy8oT1xZ", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 4 - Wiederholung Potenzrechnung - Exponentielles Wachstum", type:"pdf", googleId:"1BVSIkECgQVE4Sn_d6Ljwr2EYvIgGIIaY", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 5 - Exponentielle Wachstumsprozesse von linearem Wachstum abgrenzen", type:"pdf", googleId:"1S9abXjtsaZr-8ikRX5nL0FiTOwQne8ZY", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 6 - exponentielles Kapitalwachstum und Zu- und Abnahmen bei der Bev√∂lkerung...", type:"pdf", googleId:"1usqDNOjMydGuKFR5y-mWqaBhD9IIWXi_", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 7 - Berechnung von Gr√∂√üen beim radioaktiven Zerfall", type:"pdf", googleId:"1GbpRQUrvkF-KsFg-6yFwLw5VWlKOmczI", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 8 - L√∂sen von Aufgaben zum √úben f√ºr den Test n√§chste Woche", type:"pdf", googleId:"1OIM0SGGuAeMzClG71Kh068CzBnHZAlGb", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 9 - Aufgaben zum √úben f√ºr den Test (Abschlussrunde)", type:"pdf", googleId:"1FH3RjOvTLgqyw-QyzMN89iBCkc8ZuV41", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 10 - Einf√ºhrung lineare Funktionen", type:"pdf", googleId:"1ACk6HMmUhfx8x5OonpgERVdpv26I8hiF", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 11 - Zeichnen von linearen Funktionen - Aufstellen von Funktionsgleichungen (1. Fall)", type:"pdf", googleId:"1obkEpA9Le16leqjp6G1OBNFPgTfOioUp", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 12 - Aufstellen von Funktionsgleichungen (2. Fall)", type:"pdf", googleId:"1q61mqrxHadfkxaabQhP-qAUL8F-dUB7I", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 13 - Punktprobe, parallele und senkrechte Geraden", type:"pdf", googleId:"1JrkPgo53N-hNidc0lviecovDIgsib9tL", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 14 - Schnittpunkte von Geraden mit den Koordinatenachsen, verschiedene Aufgabenstellungen", type:"pdf", googleId:"1SwXSkMmjsOtHBMkxgrYp0dXr_1PNhYq_", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 15 - Achsenschnittpunkte und Schnittpunkte zweier Geraden berechnen", type:"pdf", googleId:"1FazxQ_cMHWR-nnus3DX4wulVdldR0_Pb", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 16 - besondere Geraden, Spiegelungen, Abstand zweier Punkte berechnen", type:"pdf", googleId:"1Rod09nQCpd25BrCjmimmF8dbxL3fyRBv", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 17 - Lineare Gleichungssysteme l√∂sen", type:"pdf", googleId:"1zuT03IBcVLy3fZehuhJYlPoPvJUIWoxb", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 18 - Aufstellen von linearen Gleichungssystemen", type:"pdf", googleId:"1EnOCW8qxi7oO7aVFtne3gNBHbUscQFzp", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 19 - Musterpr√ºfungen", type:"pdf", googleId:"1u6lQV-jCGOCCD2UKr0dlcBHp-wUpT0eh", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 20 - Geometrie - Volumen und Oberfl√§cheninhalt einer Kugel", type:"pdf", googleId:"12CF1dK1-1m5GCuuSeKIgedhMKobd52im", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 21 - Aufgaben zu Volumen und Oberfl√§cheninhalt von Kugeln", type:"pdf", googleId:"1uTKn5jZqk-Osp6Kj2y51S0-oZoDMg2-u", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 22 - Geometrie (Kugel) MSA-Aufgaben 2023 und 2024", type:"pdf", googleId:"1uV2hYvykZYAmXm5tzLI5URY4Xld_dslZ", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 23 - Zentrische Streckung - √Ñhnliche Welten", type:"pdf", googleId:"1AV_zWLExA7ZdVPGkXbtfFL-3eDo1mr-Z", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 24 - Zentrische Streckung (Fl√§cheninhalt von Bildfiguren, Volumen von Bildk√∂rpern)", type:"pdf", googleId:"170UB-7gmhUUKsgJnLa4AbKSFt-hEgwIl", version:"v1.0", important:false, tags:["Mathe","Klasse 10"], preview:true},
  {name:"Impuls 25 - Geometrie - Strahlens√§tze (1)", type:"pdf", googleId:"1gWuJcll1F_yF7UGfPZKiz6lgTQfz_19K", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 26 - Geometrie - Strahlens√§tze (X-Figur) und Anwendung der Strahlens√§tze", type:"pdf", googleId:"1sZS52r03HinpWe-sLOp5Va3qfleMG5oe", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 27 - Geometrie - Satzgruppe des Pythagoras (Katheten- und H√∂hensatz)", type:"pdf", googleId:"1hsMy7AytPWxa8rLZziCvZpI_GdO-C3aw", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 28 - Geometrie - Satz von Thales - Rechteck in fl√§chengleiches Quadrat umwandeln", type:"pdf", googleId:"1Kk9VC_4uoDGeP918JnIe7xzJv5s3l1vc", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},


  {name:"Impuls 29 - Geometrie - Wiederholung vor dem Mathetest", type:"pdf", googleId:"1IL9EX-kvv4GvVNewTThCQuSORyoM9har", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},




  {name:"Projektpr√ºfung Mappe (Vorlage leer)", type:"doc", googleId:"1ZY8C2G8pJTaIPYN4JIjsvms9sBv-TnGp", version:"v1.0", important:true, tags:["Projektpr√ºfung","Textdokument"], preview:true},
  {name:"Projektpr√ºfung Pr√§sentation (Vorlage leer)", type:"slides", googleId:"1ZsbD8ONeiFa9GTXQk0_vY-VeCHCaPBcP", version:"v1.0", important:true, tags:["Projektpr√ºfung","Pr√§sentation"], preview:true},
  {name:"Inhaltsangabe pragmatischer Texte", type:"pdf", googleId:"1NgmdB78YfK-_43Ddkw-wJlB0Wh3-fxxL", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"Inhaltsangabe literarischer Texte", type:"pdf", googleId:"1S0uEDpgT0YVV5A0D0nczr7PNNfmgt2iA", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"Der innere Monolog", type:"pdf", googleId:"1zQSlF-NYL-H7a9XDwteoFnv8uN5H5Puy", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"Der Konjunktiv", type:"pdf", googleId:"1epLQ2gJHIioP001jOS1A8yFr3WsrY1e4", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"das gehirn (Pr√§sentation 01 NuT)", type:"pdf", googleId:"1MV7LyWB4ARtQOwdW2l23esnqJg1oeDtE", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"So funktioniert unser Gehirn (Pr√§sentation 02 NuT)", type:"pdf", googleId:"1kp8JaRmul384CZcuIg9wSzsMDCADIyqp", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Nervenzelle (Pr√§sentation 03 NuT)", type:"pdf", googleId:"1KGBGGFlsWVgy5UgOvJurwJHQBUsEdI77", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Signal√ºbertragung durch Synapse (Pr√§sentation 04 NuT)", type:"pdf", googleId:"1WQlyIXcolO_ZSFncUenprTt0Y54tF3-z", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Erkrankungen des Nervensytems (Pr√§sentation 05 NuT)", type:"pdf", googleId:"1nHR4C_UmUwGMYvT08czAtc_PyQ0LFHOO", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Hormone sind Signalstoffe (Pr√§sentation 06 NuT)", type:"pdf", googleId:"18lnTlW2UkgJhp4j2y2vqGf9OPvRR7TKQ", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Geschlechtshormone und Menstruation (Pr√§sentation 07 NuT)", type:"pdf", googleId:"1J-99iUgCrUgPjAgdsCoIN8-LWMdu_kYB", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Stress (Pr√§sentation 08 NuT)", type:"pdf", googleId:"1nZB70dCB4-fljcJENJ3eA-NJe9_ue6lX", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Wachstum_DNA_Cromosom_Mitose (Pr√§sentation 09 NuT)", type:"pdf", googleId:"1WGNoTNfrbTK97Wk2ikRvA5yqLMJYLHdD", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Meiose (Pr√§sentation 10 NuT)", type:"pdf", googleId:"1CkiU73ia_nhMYaqt-up--Ke4QC_mvT1R", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Aufbau der DNA (Pr√§sentation 11 NuT)", type:"pdf", googleId:"1O3wcwEimefDuWi9GQ9SllE9tFdm3Jkv7", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},

  {name:"test", type:"mp3", googleId:"1qVzvmSAYrVz0bdAhQd8SDfB5PeXt2bo_", version:"v1.0", important:false, tags:["Audio"], preview:true},
  
  
  {name:"Zivilrecht, Strafrecht oder Verwaltungsrecht", type:"youtube", googleId:"vFq97jn48V8", version:"v1.0", important:false, tags:["WiB","Klasse 10","Video"], preview:true},
  
  
];

let customFiles=JSON.parse(localStorage.getItem("files"))||[];
let downloads=Number(localStorage.getItem("downloads"))||0;
document.getElementById("stats").innerText=`üìä Downloads gesamt: ${downloads}`;

function getLinks(file){
  if(file.type==="doc") return {
    view:`https://docs.google.com/document/d/${file.googleId}/preview`, 
    download:`https://docs.google.com/document/d/${file.googleId}/export?format=pdf`
  };
  if(file.type==="slides") return {
    view:`https://docs.google.com/presentation/d/${file.googleId}/preview`, 
    download:`https://docs.google.com/presentation/d/${file.googleId}/export/pdf`
  };
  if(file.type==="pdf") return {
    view:`https://drive.google.com/file/d/${file.googleId}/preview`, 
    download:`https://drive.google.com/uc?export=download&id=${file.googleId}`
  };
  if(file.type==="mp3") return {
    view:`https://drive.google.com/file/d/${file.googleId}/preview`, 
    download:`https://drive.google.com/uc?export=download&id=${file.googleId}`,
    audio:`https://drive.google.com/uc?export=download&id=${file.googleId}`
  };
  if(file.type==="youtube") return {
    view:`https://www.youtube.com/embed/${file.googleId}`,
    download:`https://www.youtube.com/watch?v=${file.googleId}`
  };
}

function saveFiles(){ localStorage.setItem("files",JSON.stringify(customFiles)); }

function renderFiles(){
  const list=document.getElementById("fileList");
  list.innerHTML="";
  const allFiles=[...defaultFiles,...customFiles];
  const isAdmin=localStorage.getItem("isAdmin")==="true";

  const tagContainer=document.getElementById("tagContainer");
  let tagsSet=new Set();
  allFiles.forEach(f=>f.tags.forEach(t=>tagsSet.add(t)));
  tagContainer.innerHTML="";
  const allBtn=document.createElement("div");
  allBtn.className="tag active"; allBtn.dataset.tag="all"; allBtn.innerText="Alle";
  allBtn.onclick=()=>filterByTag("all",allBtn); tagContainer.appendChild(allBtn);
  tagsSet.forEach(t=>{
    const div=document.createElement("div");
    div.className="tag"; div.dataset.tag=t; div.innerText=t;
    div.onclick=()=>filterByTag(t,div); tagContainer.appendChild(div);
  });

  allFiles.forEach((file,index)=>{
    const links=getLinks(file);
    const downloaded=Number(localStorage.getItem("downloaded_"+file.googleId))||0;
    const tagsStr=file.tags.join(", ");
    const hasPreview = file.preview === true;
    const audioId = 'audio-' + file.googleId;
    
    list.innerHTML+=`
      <div class="file" data-title="${file.name.toLowerCase()}" data-tags="${file.tags.join(",").toLowerCase()}" data-type="${file.type}">
        <strong>${file.name}</strong> ${file.important?"üî•":""}
        <div class="info">
          ${getTypeIcon(file.type)} ${file.version} | 
          Tags: ${tagsStr} | 
          Downloads: ${downloaded} 
          ${hasPreview ? '| üëÅÔ∏è Vorschau verf√ºgbar' : ''}
        </div>
        <div class="buttons">
          <a class="view" href="${file.type === 'mp3' ? '#' : links.view}" 
             ${file.type === 'mp3' ? 'onclick="return false;"' : 'target="_blank"'} 
             style="${file.type === 'mp3' ? 'opacity:0.5; cursor:default;"' : ''}">
            ${file.type === 'mp3' ? 'üîä' : 'üëÅÔ∏è'} Ansicht
          </a>
          <a class="download" href="${links.download}" onclick="count('${file.googleId}')">üì• Download</a>
          ${hasPreview ? `<button class="preview-btn" onclick="togglePreview(this, '${file.googleId}')">
            ${file.type === 'mp3' ? 'üéµ Player anzeigen' : 'üëÅÔ∏è Vorschau zeigen'}
          </button>` : ''}
          <label class="checkbox"><input type="checkbox" onclick="toggleDownloaded('${file.googleId}')" ${downloaded>0?"checked":""}> Hab ich geladen</label>
          ${isAdmin?`<button onclick="deleteFile(${index})">üóëÔ∏è</button>`:""}
        </div>
        ${file.type === 'mp3' && hasPreview ? `
          <div class="audio-player" id="player-${file.googleId}">
            <audio id="${audioId}" ontimeupdate="updateTime(this)" 
                   src="${links.audio}" preload="metadata"></audio>
            <div class="player-controls">
              <button class="play-btn" onclick="toggleAudio(this)">‚ñ∂Ô∏è Abspielen</button>
              <span class="time-display">0:00 / 0:00</span>
              <input type="range" min="0" max="1" step="0.1" value="1" 
                     class="volume-slider" 
                     onchange="changeVolume(this, '${audioId}')">
            </div>
          </div>
        ` : ''}
        ${(file.type === 'pdf' || file.type === 'doc' || file.type === 'slides' || file.type === 'youtube') && hasPreview ? 
          `<iframe class="preview-frame" src="${links.view}" data-has-preview="true"></iframe>` : ''}
      </div>`;
  });
}

function getTypeIcon(type) {
  const icons = {
    'pdf': 'üìÑ',
    'doc': 'üìù',
    'slides': 'üìä',
    'mp3': 'üéµ',
    'youtube': 'üé¨'
  };
  return icons[type] || 'üìÅ';
}

// Download-Z√§hler
function count(gid){ downloads++; localStorage.setItem("downloads",downloads); localStorage.setItem("downloaded_"+gid,Number(localStorage.getItem("downloaded_"+gid)||0)+1); document.getElementById("stats").innerText=`üìä Downloads gesamt: ${downloads}`; renderFiles(); }
function toggleDownloaded(gid){ const key="downloaded_"+gid; localStorage.setItem(key,!JSON.parse(localStorage.getItem(key))); renderFiles(); }
document.getElementById("search").oninput=()=>{ 
  const v=document.getElementById("search").value.toLowerCase(); 
  document.querySelectorAll(".file").forEach(f=>{
    const matchesSearch = f.dataset.title.includes(v);
    const fileType = f.dataset.type;
    const isFiltered = document.querySelector('.filter-btn.active').textContent;
    
    let shouldShow = matchesSearch;
    if (isFiltered !== 'Alle') {
      const filterType = isFiltered.includes('PDF') ? 'pdf' : 
                        isFiltered.includes('Dokumente') ? 'doc' :
                        isFiltered.includes('Pr√§sentationen') ? 'slides' :
                        isFiltered.includes('Audio') ? 'mp3' : 'all';
      shouldShow = shouldShow && (filterType === 'all' || fileType === filterType);
    }
    
    f.style.display = shouldShow ? "block" : "none";
  });
}

function filterByTag(tag,element){ 
  document.querySelectorAll(".tag").forEach(x=>x.classList.remove("active")); 
  element.classList.add("active"); 
  document.querySelectorAll(".file").forEach(f=>{
    f.style.display=(tag==="all"||f.dataset.tags.includes(tag.toLowerCase()))?"block":"none";
  });
}

// Admin
function login(){ const u=prompt("Admin Name:"); const p=prompt("Passwort:"); if(u===ADMIN_USER && p===ADMIN_PASS){ localStorage.setItem("isAdmin","true"); document.getElementById("adminPanel").style.display="block"; renderFiles(); alert("Admin aktiv");} else alert("Falsch!"); }
function logout(){ localStorage.removeItem("isAdmin"); document.getElementById("adminPanel").style.display="none"; renderFiles(); }

// Admin: Neue Datei hinzuf√ºgen
function addFile(){
  const name=document.getElementById("fname").value.trim();
  const link=document.getElementById("gid").value.trim();
  const type=document.getElementById("ftype").value;
  const tags=document.getElementById("ftags").value.split(",").map(t=>t.trim()).filter(t=>t);
  const preview=document.getElementById("fpreview").checked;

  if(!name || !link){
    alert("Bitte Name und Link eingeben!");
    return;
  }

  let fileId;
  if (type === 'youtube') {
    // YouTube ID extrahieren
    const youtubeMatch = link.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
    if (youtubeMatch) {
      fileId = youtubeMatch[1];
    } else if (link.length === 11) {
      fileId = link; // Direkte YouTube ID
    } else {
      alert("Ung√ºltiger YouTube Link!");
      return;
    }
  } else {
    // Google Drive Link
    let idMatch = link.match(/\/d\/([a-zA-Z0-9_-]+)/);
    if(!idMatch){ 
      // Vielleicht direkte ID?
      if(link.match(/^[a-zA-Z0-9_-]{20,}$/)) {
        fileId = link;
      } else {
        alert("Ung√ºltiger Google Drive Link!");
        return;
      }
    } else {
      fileId = idMatch[1];
    }
  }

  customFiles.push({name,type,googleId:fileId,version:"v1.0",important:false,tags,preview});
  saveFiles();
  renderFiles();
  document.getElementById("fname").value="";
  document.getElementById("gid").value="";
  document.getElementById("ftags").value="";
  document.getElementById("fpreview").checked = false;
}

// Tabelle & CSV
function showTable(){
  const allFiles=[...defaultFiles,...customFiles];
  let html="<table><tr><th>Typ</th><th>Name</th><th>Version</th><th>Tags</th><th>Downloads</th><th>Vorschau</th></tr>";
  allFiles.forEach(f=>{
    const d=Number(localStorage.getItem("downloaded_"+f.googleId))||0;
    html+=`<tr><td>${getTypeIcon(f.type)} ${f.type}</td><td>${f.name}</td><td>${f.version}</td><td>${f.tags.join(", ")}</td><td>${d}</td><td>${f.preview ? '‚úÖ' : '‚ùå'}</td></tr>`;
  });
  html+="</table>";
  document.getElementById("fileTableContainer").innerHTML=html;
}

function exportCSV(){
  const allFiles=[...defaultFiles,...customFiles];
  let csv="Typ,Name,Version,Tags,Downloads,Vorschau\n";
  allFiles.forEach(f=>{
    const d=Number(localStorage.getItem("downloaded_"+f.googleId))||0;
    csv+=`"${f.type}","${f.name}","${f.version}","${f.tags.join(", ")}","${d}","${f.preview ? 'Ja' : 'Nein'}"\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="files.csv"; a.click();
  URL.revokeObjectURL(url);
}

// Delete
function deleteFile(index){ if(confirm("Datei wirklich l√∂schen?")){ customFiles.splice(index-defaultFiles.length,1); saveFiles(); renderFiles(); } }

renderFiles();
function deleteAllLocalFiles(){
  if(!confirm("‚ö†Ô∏è Wirklich ALLE lokal gespeicherten Dateien l√∂schen?\n(Standard-Dateien bleiben erhalten)")) return;

  localStorage.removeItem("files");       // Custom Files
  customFiles = [];                       // Speicher leeren

  // Optional: Download-H√§kchen & Z√§hler zur√ºcksetzen
  Object.keys(localStorage).forEach(k=>{
    if(k.startsWith("downloaded_")) localStorage.removeItem(k);
  });

  alert("‚úÖ Alle lokalen Dateien wurden gel√∂scht.");
  renderFiles();
}

</script>

<!-- Pi-Mini-Spiel Icon (versteckt, unten rechts) -->
<div id="pi-button" 
     style="
       position:fixed;
       bottom:20px;
       right:20px;
       width:40px;
       height:40px;
       background:#ff2d2d;
       color:white;
       font-weight:bold;
       font-size:18px;
       border-radius:50%;
       display:flex;
       justify-content:center;
       align-items:center;
       cursor:pointer;
       z-index:9999;
     " title="Pi-Mini-Spiel">œÄ</div>

<!-- Pi-Mini-Spiel Overlay (hidden) -->
<div id="pi-overlay" style="
     display:none;
     position:fixed;
     inset:0;
     background:rgba(0,0,0,0.85);
     z-index:10000;
     font-family:Arial, sans-serif;
     color:white;
     justify-content:center;
     align-items:center;
">
  <div style="background:#111;padding:20px;border-radius:18px;text-align:center;max-width:400px;width:90%;">
    <h2>ü•ß Pi-Mini-Spiel</h2>
    <div id="pi-display" style="font-size:24px;margin-bottom:16px;">3.</div>
    <div id="pi-buttons" style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:10px;"></div>
    <p style="opacity:0.7;margin-top:10px;">Falsche Zahl ‚Üí Spiel endet</p>
    <button onclick="closePiGame()" style="margin-top:12px;padding:8px 16px;border:none;border-radius:12px;background:#ff2d2d;color:white;cursor:pointer;">
      Schlie√üen
    </button>
  </div>
</div>

<script>
// Erste 500 Nachkommastellen von Pi
const PI_DIGITS = "14159265358979323846264338327950288419716939937510" +
"58209749445923078164062862089986280348253421170679" +
"82148086513282306647093844609550582231725359408128" +
"48111745028410270193852110555964462294895493038196" +
"44288109756659334461284756482337867831652712019091" +
"45648566923460348610454326648213393607260249141273" +
"72458700660631558817488152092096282925409171536436" +
"78925903600113305305488204665213841469519415116094" +
"33057270365759591953092186117381932611793105118548" +
"07446237996274956735188575272489122793818301194912";

let piIndex = 0;
const piButton = document.getElementById("pi-button");
const piOverlay = document.getElementById("pi-overlay");
const piDisplay = document.getElementById("pi-display");
const piButtonsContainer = document.getElementById("pi-buttons");

// Buttons 0-9 generieren
for(let i=0; i<=9; i++){
  const btn = document.createElement("button");
  btn.textContent = i;
  btn.style.cssText = "padding:12px;font-size:18px;border-radius:12px;border:none;cursor:pointer;background:#222;color:white;";
  btn.onclick = ()=>checkPiDigit(i.toString());
  piButtonsContainer.appendChild(btn);
}

// Spiel erst bei Klick starten
piButton.onclick = ()=>{
  piIndex = 0;
  piDisplay.textContent = "3.";
  piOverlay.style.display = "flex";
};

// Pr√ºfen der Eingabe
function checkPiDigit(num){
  if(num === PI_DIGITS[piIndex]){
    piDisplay.textContent += num;
    piIndex++;
  } else {
    alert("Falsche Zahl! Spiel endet.");
    closePiGame();
  }
}

// Spiel schlie√üen
function closePiGame(){
  piOverlay.style.display = "none";
}

// Keyboard-Eingabe
document.addEventListener("keydown", e=>{
  if(piOverlay.style.display==="flex" && /^[0-9]$/.test(e.key)){
    checkPiDigit(e.key);
  }
});

</script>

</body>
</html>