<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Pr√ºfungsvorbereitung Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{--accent:#ff2d2d;--bg:#0f0f0f;--card:#1e1e1e;--text:#fff;--font:"Arial",sans-serif;--fontsize:15px}
body{margin:0;font-family:var(--font);font-size:var(--fontsize);background:var(--bg);color:var(--text);padding:20px;padding-bottom:220px}
h1{margin-bottom:10px}
.update{background:var(--accent);color:#000;padding:12px;border-radius:12px;margin-bottom:15px;font-weight:bold;text-align:center}
input,select,button{padding:10px;border-radius:10px;border:none;font-size:var(--fontsize)}
button{cursor:pointer;font-weight:bold;background:var(--accent);color:#000}
.tags{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}
.tag{background:#2a2a2a;padding:6px 14px;border-radius:20px;cursor:pointer}
.tag.active{background:var(--accent);color:#000}
.file{background:var(--card);padding:15px;border-radius:14px;margin-bottom:25px}
.file strong{font-size:18px;display:block;margin-bottom:5px}
.file .info{font-size:13px;color:#aaa;margin-bottom:8px}
.file .buttons{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px;align-items:center}
.file .buttons a,.file .buttons button{text-decoration:none;padding:8px 14px;border-radius:10px;font-weight:bold;cursor:pointer}
.file .buttons a.view{background:#333;color:#fff}
.file .buttons a.download{background:var(--accent);color:#000}
.preview-frame{width:100%;height:450px;border-radius:12px;border:none;margin-top:10px;display:none}
.preview-frame.show{display:block}
.audio-player{background:#2a2a2a;border-radius:12px;padding:15px;margin-top:10px;display:none}
.audio-player.show{display:block}
.audio-player audio{width:100%;margin-bottom:10px}
.filter-buttons{display:flex;gap:10px;margin:15px 0;flex-wrap:wrap}
.filter-btn{background:#333;color:white;border:none;padding:8px 16px;border-radius:8px;cursor:pointer}
.filter-btn.active{background:var(--accent);color:#000}
#settingsPanel{margin-bottom:20px;background:#1a1a1a;padding:15px;border-radius:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px}
.sticky{position:fixed;bottom:0;left:0;width:100%;background:#141414;padding:15px;border-top:2px solid var(--accent);display:flex;justify-content:space-around;flex-wrap:wrap;gap:10px;z-index:999}

/* Pi Button - Unten rechts */
.pi-button {
  position: fixed;
  bottom: 90px; /* √úber der sticky bar */
  right: 20px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #ff2d2d, #ff6b6b);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  z-index: 1000;
  box-shadow: 0 4px 15px rgba(255, 45, 45, 0.4);
  text-decoration: none;
  transition: all 0.3s;
  border: 2px solid white;
}

.pi-button:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(255, 45, 45, 0.6);
  background: linear-gradient(135deg, #ff6b6b, #ff2d2d);
}

.pi-button:active {
  transform: scale(0.95);
}
</style>
</head>
<body>

<!-- Pi Button - Unten rechts -->
<a href="https://montessoriregensburg.github.io/pi" target="_blank" class="pi-button" title="Zur Pi-Website">
  œÄ
</a>

<div id="settingsPanel">
  <label>Hintergrund <input type="color" id="bgColor" value="#0f0f0f"></label>
  <label>Textfarbe <input type="color" id="textColor" value="#ffffff"></label>
  <label>Akzentfarbe <input type="color" id="accentColor" value="#ff2d2d"></label>
  <label>Schriftart 
    <select id="fontSelect">
      <option value="Arial, sans-serif">Arial</option>
      <option value="Verdana, sans-serif">Verdana</option>
      <option value="Courier New, monospace">Courier New</option>
      <option value="Georgia, serif">Georgia</option>
    </select>
  </label>
  <label>Schriftgr√∂√üe <input type="number" id="fontSize" value="15" min="10" max="30">px</label>
  <select id="presetDesigns">
    <option value="0">Standard (Dunkel/Rot)</option>
    <option value="1">Hell/Blau</option>
    <option value="2">Gr√ºn/Schwarz</option>
    <option value="3">Violett/Dunkel</option>
  </select>
  <button onclick="toggleTheme()">Dark/Light</button>
</div>

<div class="update">üîî Version 0.7 mit Pi-Link</div>
<h1>üìÇ Pr√ºfungsvorbereitung</h1>
<p id="stats">üìä Downloads gesamt: 0</p>
<input id="search" placeholder="üîç Datei suchen ‚Ä¶">

<div class="filter-buttons">
  <button class="filter-btn active" onclick="filterByType('all')">Alle</button>
  <button class="filter-btn" onclick="filterByType('pdf')">üìÑ PDF</button>
  <button class="filter-btn" onclick="filterByType('doc')">üìù Dokumente</button>
  <button class="filter-btn" onclick="filterByType('slides')">üìä Pr√§sentationen</button>
  <button class="filter-btn" onclick="filterByType('mp3')">üéµ Audio</button>
  <button class="filter-btn" onclick="filterByType('youtube')">üé¨ YouTube</button>
</div>

<button onclick="toggleAllPreviews()" style="margin-bottom:20px;">üëÅÔ∏è Alle Vorschauen an/aus</button>
<div class="tags" id="tagContainer"></div>
<div id="fileList"></div>

<button onclick="login()">Admin Login</button>
<button onclick="logout()">Logout</button>

<div id="adminPanel" style="display:none;">
  <h3>‚ûï Neue Datei</h3>
  <input id="fname" placeholder="Dateiname">
  <input id="gid" placeholder="Google Drive Link oder YouTube ID">
  <select id="ftype">
    <option value="doc">Textdokument</option>
    <option value="slides">Pr√§sentation</option>
    <option value="pdf">PDF</option>
    <option value="mp3">Audio</option>
    <option value="youtube">YouTube</option>
  </select>
  <input id="ftags" placeholder="Tags">
  <label><input type="checkbox" id="fpreview"> Vorschau</label>
  <button onclick="addFile()">‚ûï Hinzuf√ºgen</button>
</div>

<div class="sticky">
  <button onclick="alert('ZIP-Download ben√∂tigt Server')">üì¶ ZIP</button>
  <button onclick="login()">üîí Admin</button>
  <button onclick="window.scrollTo({top:0,behavior:'smooth'})">‚¨ÜÔ∏è Top</button>
</div>

<script>
// WICHTIG: Die defaultFiles m√ºssen hier richtig definiert sein
const defaultFiles = [
 {name:"Impuls 1 - Potenzen und Wurzeln", type:"pdf", googleId:"1K3fuoW8fUEJKSF40SV1prjVcgiEYk9Q-", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 2 - Potenzen und Wurzeln", type:"pdf", googleId:"1jQPdxk7zcjjqKNGCtMIwA0GF-V0WigUA", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 3 - Potenzen und Wurzeln", type:"pdf", googleId:"1sbbDAcAOrREqA4ygLzgSBPBlNy8oT1xZ", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 4 - Wiederholung Potenzrechnung - Exponentielles Wachstum", type:"pdf", googleId:"1BVSIkECgQVE4Sn_d6Ljwr2EYvIgGIIaY", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 5 - Exponentielle Wachstumsprozesse von linearem Wachstum abgrenzen", type:"pdf", googleId:"1S9abXjtsaZr-8ikRX5nL0FiTOwQne8ZY", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 6 - exponentielles Kapitalwachstum und Zu- und Abnahmen bei der Bev√∂lkerung...", type:"pdf", googleId:"1usqDNOjMydGuKFR5y-mWqaBhD9IIWXi_", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 7 - Berechnung von Gr√∂√üen beim radioaktiven Zerfall", type:"pdf", googleId:"1GbpRQUrvkF-KsFg-6yFwLw5VWlKOmczI", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 8 - L√∂sen von Aufgaben zum √úben f√ºr den Test n√§chste Woche", type:"pdf", googleId:"1OIM0SGGuAeMzClG71Kh068CzBnHZAlGb", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 9 - Aufgaben zum √úben f√ºr den Test (Abschlussrunde)", type:"pdf", googleId:"1FH3RjOvTLgqyw-QyzMN89iBCkc8ZuV41", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 10 - Einf√ºhrung lineare Funktionen", type:"pdf", googleId:"1ACk6HMmUhfx8x5OonpgERVdpv26I8hiF", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 11 - Zeichnen von linearen Funktionen - Aufstellen von Funktionsgleichungen (1. Fall)", type:"pdf", googleId:"1obkEpA9Le16leqjp6G1OBNFPgTfOioUp", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 12 - Aufstellen von Funktionsgleichungen (2. Fall)", type:"pdf", googleId:"1q61mqrxHadfkxaabQhP-qAUL8F-dUB7I", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 13 - Punktprobe, parallele und senkrechte Geraden", type:"pdf", googleId:"1JrkPgo53N-hNidc0lviecovDIgsib9tL", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 14 - Schnittpunkte von Geraden mit den Koordinatenachsen, verschiedene Aufgabenstellungen", type:"pdf", googleId:"1SwXSkMmjsOtHBMkxgrYp0dXr_1PNhYq_", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 15 - Achsenschnittpunkte und Schnittpunkte zweier Geraden berechnen", type:"pdf", googleId:"1FazxQ_cMHWR-nnus3DX4wulVdldR0_Pb", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 16 - besondere Geraden, Spiegelungen, Abstand zweier Punkte berechnen", type:"pdf", googleId:"1Rod09nQCpd25BrCjmimmF8dbxL3fyRBv", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 17 - Lineare Gleichungssysteme l√∂sen", type:"pdf", googleId:"1zuT03IBcVLy3fZehuhJYlPoPvJUIWoxb", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 18 - Aufstellen von linearen Gleichungssystemen", type:"pdf", googleId:"1EnOCW8qxi7oO7aVFtne3gNBHbUscQFzp", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 19 - Musterpr√ºfungen", type:"pdf", googleId:"1u6lQV-jCGOCCD2UKr0dlcBHp-wUpT0eh", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 20 - Geometrie - Volumen und Oberfl√§cheninhalt einer Kugel", type:"pdf", googleId:"12CF1dK1-1m5GCuuSeKIgedhMKobd52im", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 21 - Aufgaben zu Volumen und Oberfl√§cheninhalt von Kugeln", type:"pdf", googleId:"1uTKn5jZqk-Osp6Kj2y51S0-oZoDMg2-u", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 22 - Geometrie (Kugel) MSA-Aufgaben 2023 und 2024", type:"pdf", googleId:"1uV2hYvykZYAmXm5tzLI5URY4Xld_dslZ", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 23 - Zentrische Streckung - √Ñhnliche Welten", type:"pdf", googleId:"1AV_zWLExA7ZdVPGkXbtfFL-3eDo1mr-Z", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 24 - Zentrische Streckung (Fl√§cheninhalt von Bildfiguren, Volumen von Bildk√∂rpern)", type:"pdf", googleId:"170UB-7gmhUUKsgJnLa4AbKSFt-hEgwIl", version:"v1.0", important:false, tags:["Mathe","Klasse 10"], preview:true},
  {name:"Impuls 25 - Geometrie - Strahlens√§tze (1)", type:"pdf", googleId:"1gWuJcll1F_yF7UGfPZKiz6lgTQfz_19K", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 26 - Geometrie - Strahlens√§tze (X-Figur) und Anwendung der Strahlens√§tze", type:"pdf", googleId:"1sZS52r03HinpWe-sLOp5Va3qfleMG5oe", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 27 - Geometrie - Satzgruppe des Pythagoras (Katheten- und H√∂hensatz)", type:"pdf", googleId:"1hsMy7AytPWxa8rLZziCvZpI_GdO-C3aw", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},
  {name:"Impuls 28 - Geometrie - Satz von Thales - Rechteck in fl√§chengleiches Quadrat umwandeln", type:"pdf", googleId:"1Kk9VC_4uoDGeP918JnIe7xzJv5s3l1vc", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},


  {name:"Impuls 29 - Geometrie - Wiederholung vor dem Mathetest", type:"pdf", googleId:"1IL9EX-kvv4GvVNewTThCQuSORyoM9har", version:"v1.0", important:false, tags:["Mathe","Klasse 10","PDF"], preview:true},




  {name:"Projektpr√ºfung Mappe (Vorlage leer)", type:"doc", googleId:"1ZY8C2G8pJTaIPYN4JIjsvms9sBv-TnGp", version:"v1.0", important:true, tags:["Projektpr√ºfung","Textdokument"], preview:true},
  {name:"Projektpr√ºfung Pr√§sentation (Vorlage leer)", type:"slides", googleId:"1ZsbD8ONeiFa9GTXQk0_vY-VeCHCaPBcP", version:"v1.0", important:true, tags:["Projektpr√ºfung","Pr√§sentation"], preview:true},
  {name:"Inhaltsangabe pragmatischer Texte", type:"pdf", googleId:"1NgmdB78YfK-_43Ddkw-wJlB0Wh3-fxxL", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"Inhaltsangabe literarischer Texte", type:"pdf", googleId:"1S0uEDpgT0YVV5A0D0nczr7PNNfmgt2iA", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"Der innere Monolog", type:"pdf", googleId:"1zQSlF-NYL-H7a9XDwteoFnv8uN5H5Puy", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"Der Konjunktiv", type:"pdf", googleId:"1epLQ2gJHIioP001jOS1A8yFr3WsrY1e4", version:"v1.0", important:false, tags:["Deutsch","Klasse 10","PDF"], preview:true},
  {name:"das gehirn (Pr√§sentation 01 NuT)", type:"pdf", googleId:"1MV7LyWB4ARtQOwdW2l23esnqJg1oeDtE", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"So funktioniert unser Gehirn (Pr√§sentation 02 NuT)", type:"pdf", googleId:"1kp8JaRmul384CZcuIg9wSzsMDCADIyqp", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Nervenzelle (Pr√§sentation 03 NuT)", type:"pdf", googleId:"1KGBGGFlsWVgy5UgOvJurwJHQBUsEdI77", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Signal√ºbertragung durch Synapse (Pr√§sentation 04 NuT)", type:"pdf", googleId:"1WQlyIXcolO_ZSFncUenprTt0Y54tF3-z", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Erkrankungen des Nervensytems (Pr√§sentation 05 NuT)", type:"pdf", googleId:"1nHR4C_UmUwGMYvT08czAtc_PyQ0LFHOO", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Hormone sind Signalstoffe (Pr√§sentation 06 NuT)", type:"pdf", googleId:"18lnTlW2UkgJhp4j2y2vqGf9OPvRR7TKQ", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Geschlechtshormone und Menstruation (Pr√§sentation 07 NuT)", type:"pdf", googleId:"1J-99iUgCrUgPjAgdsCoIN8-LWMdu_kYB", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Stress (Pr√§sentation 08 NuT)", type:"pdf", googleId:"1nZB70dCB4-fljcJENJ3eA-NJe9_ue6lX", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Wachstum_DNA_Cromosom_Mitose (Pr√§sentation 09 NuT)", type:"pdf", googleId:"1WGNoTNfrbTK97Wk2ikRvA5yqLMJYLHdD", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Meiose (Pr√§sentation 10 NuT)", type:"pdf", googleId:"1CkiU73ia_nhMYaqt-up--Ke4QC_mvT1R", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},
  {name:"Aufbau der DNA (Pr√§sentation 11 NuT)", type:"pdf", googleId:"1O3wcwEimefDuWi9GQ9SllE9tFdm3Jkv7", version:"v1.0", important:false, tags:["NuT","Klasse 10","PDF"], preview:true},

  {name:"test", type:"mp3", googleId:"1qVzvmSAYrVz0bdAhQd8SDfB5PeXt2bo_", version:"v1.0", important:false, tags:["Audio"], preview:true},
  
  
  {name:"Zivilrecht, Strafrecht oder Verwaltungsrecht", type:"youtube", googleId:"vFq97jn48V8", version:"v1.0", important:false, tags:["WiB","Klasse 10","Video"], preview:true},
  
  
];

let customFiles = JSON.parse(localStorage.getItem("files")) || [];
let downloads = Number(localStorage.getItem("downloads")) || 0;

function getLinks(file) {
  if(file.type === "doc") return {
    view: `https://docs.google.com/document/d/${file.googleId}/preview`,
    download: `https://docs.google.com/document/d/${file.googleId}/export?format=pdf`
  };
  if(file.type === "slides") return {
    view: `https://docs.google.com/presentation/d/${file.googleId}/preview`,
    download: `https://docs.google.com/presentation/d/${file.googleId}/export/pdf`
  };
  if(file.type === "pdf") return {
    view: `https://drive.google.com/file/d/${file.googleId}/preview`,
    download: `https://drive.google.com/uc?export=download&id=${file.googleId}`
  };
  if(file.type === "mp3") return {
    view: `https://drive.google.com/file/d/${file.googleId}/preview`,
    download: `https://drive.google.com/uc?export=download&id=${file.googleId}`,
    audio: `https://drive.google.com/uc?export=download&id=${file.googleId}`
  };
  if(file.type === "youtube") return {
    view: `https://www.youtube.com/embed/${file.googleId}`,
    download: `https://www.youtube.com/watch?v=${file.googleId}`
  };
  return {view:"#",download:"#"};
}

function renderFiles() {
  const list = document.getElementById("fileList");
  const allFiles = [...defaultFiles, ...customFiles];
  
  // Tags aktualisieren
  const tagContainer = document.getElementById("tagContainer");
  let tagsSet = new Set();
  allFiles.forEach(f => f.tags.forEach(t => tagsSet.add(t)));
  
  tagContainer.innerHTML = '<div class="tag active" onclick="filterByTag(\'all\',this)">Alle</div>';
  tagsSet.forEach(tag => {
    tagContainer.innerHTML += `<div class="tag" onclick="filterByTag('${tag}',this)">${tag}</div>`;
  });
  
  // Dateien anzeigen
  list.innerHTML = "";
  allFiles.forEach((file, index) => {
    const links = getLinks(file);
    const downloaded = Number(localStorage.getItem("downloaded_" + file.googleId)) || 0;
    const hasPreview = file.preview === true;
    
    let html = `
      <div class="file" data-title="${file.name.toLowerCase()}" data-tags="${file.tags.join(',').toLowerCase()}" data-type="${file.type}">
        <strong>${file.name} ${file.important?"üî•":""}</strong>
        <div class="info">
          ${file.type==='pdf'?'üìÑ':file.type==='doc'?'üìù':file.type==='slides'?'üìä':file.type==='mp3'?'üéµ':'üé¨'} 
          ${file.version} | Tags: ${file.tags.join(", ")} | Downloads: ${downloaded}
        </div>
        <div class="buttons">
          <a class="view" href="${links.view}" ${file.type !== 'mp3' ? 'target="_blank"' : ''} onclick="${file.type === 'mp3' ? 'return false;' : ''}">
            ${file.type === 'mp3' ? 'üîä' : 'üëÅÔ∏è'} Ansicht
          </a>
          <a class="download" href="${links.download}" onclick="countDownload('${file.googleId}')">üì• Download</a>
    `;
    
    if(hasPreview) {
      html += `<button class="preview-btn" onclick="togglePreview(this, '${file.googleId}')">
                ${file.type === 'mp3' ? 'üéµ Player' : 'üëÅÔ∏è Vorschau'}
              </button>`;
    }
    
    html += `
          <label class="checkbox">
            <input type="checkbox" onclick="toggleDownloaded('${file.googleId}')" ${downloaded>0?"checked":""}>
            Geladen
          </label>
        </div>
    `;
    
    // Audio Player oder Preview Frame
    if(file.type === 'mp3' && hasPreview) {
      html += `
        <div class="audio-player" id="player-${file.googleId}">
          <audio id="audio-${file.googleId}" ontimeupdate="updateTime(this)" src="${links.audio}"></audio>
          <button onclick="toggleAudio(this)">‚ñ∂Ô∏è Play</button>
          <span class="time-display">0:00 / 0:00</span>
        </div>
      `;
    } else if(hasPreview && (file.type === 'pdf' || file.type === 'doc' || file.type === 'slides' || file.type === 'youtube')) {
      html += `<iframe class="preview-frame" src="${links.view}"></iframe>`;
    }
    
    html += `</div>`;
    list.innerHTML += html;
  });
  
  document.getElementById("stats").innerText = `üìä Downloads gesamt: ${downloads}`;
}

function countDownload(gid) {
  downloads++;
  localStorage.setItem("downloads", downloads);
  localStorage.setItem("downloaded_" + gid, (Number(localStorage.getItem("downloaded_" + gid)) || 0) + 1);
  renderFiles();
}

function toggleDownloaded(gid) {
  const key = "downloaded_" + gid;
  const current = JSON.parse(localStorage.getItem(key)) || false;
  localStorage.setItem(key, !current);
  renderFiles();
}

function togglePreview(button, fileId) {
  const container = button.parentElement.parentElement;
  const previewFrame = container.querySelector('.preview-frame');
  const audioPlayer = container.querySelector('.audio-player');
  
  if(previewFrame) {
    previewFrame.classList.toggle('show');
    button.textContent = previewFrame.classList.contains('show') ? 'üëÅÔ∏è Verstecken' : 'üëÅÔ∏è Vorschau';
  }
  
  if(audioPlayer) {
    audioPlayer.classList.toggle('show');
    button.textContent = audioPlayer.classList.contains('show') ? 'üéµ Verstecken' : 'üéµ Player';
  }
}

function toggleAllPreviews() {
  document.querySelectorAll('.preview-frame, .audio-player').forEach(el => {
    el.classList.toggle('show');
  });
}

function filterByTag(tag, element) {
  document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
  element.classList.add('active');
  
  document.querySelectorAll('.file').forEach(file => {
    if(tag === 'all' || file.dataset.tags.includes(tag.toLowerCase())) {
      file.style.display = 'block';
    } else {
      file.style.display = 'none';
    }
  });
}

function filterByType(type) {
  document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  document.querySelectorAll('.file').forEach(file => {
    if(type === 'all' || file.dataset.type === type) {
      file.style.display = 'block';
    } else {
      file.style.display = 'none';
    }
  });
}

// Suchfunktion
document.getElementById("search").oninput = function() {
  const search = this.value.toLowerCase();
  document.querySelectorAll('.file').forEach(file => {
    if(file.dataset.title.includes(search)) {
      file.style.display = 'block';
    } else {
      file.style.display = 'none';
    }
  });
};

// Admin Funktionen
const ADMIN_USER = "admin";
const ADMIN_PASS = "1234";

function login() {
  const user = prompt("Admin Name:");
  const pass = prompt("Passwort:");
  if(user === ADMIN_USER && pass === ADMIN_PASS) {
    localStorage.setItem("isAdmin", "true");
    document.getElementById("adminPanel").style.display = "block";
    alert("Admin aktiv");
  } else {
    alert("Falsche Login-Daten!");
  }
}

function logout() {
  localStorage.removeItem("isAdmin");
  document.getElementById("adminPanel").style.display = "none";
}

function addFile() {
  const name = document.getElementById("fname").value.trim();
  const link = document.getElementById("gid").value.trim();
  const type = document.getElementById("ftype").value;
  const tags = document.getElementById("ftags").value.split(",").map(t => t.trim()).filter(t => t);
  const preview = document.getElementById("fpreview").checked;
  
  if(!name || !link) {
    alert("Bitte Name und Link eingeben!");
    return;
  }
  
  let fileId;
  if(type === 'youtube') {
    const match = link.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
    if(match) fileId = match[1];
    else if(link.length === 11) fileId = link;
    else { alert("Ung√ºltiger YouTube Link!"); return; }
  } else {
    const match = link.match(/\/d\/([a-zA-Z0-9_-]+)/);
    if(match) fileId = match[1];
    else if(link.match(/^[a-zA-Z0-9_-]{20,}$/)) fileId = link;
    else { alert("Ung√ºltiger Google Drive Link!"); return; }
  }
  
  customFiles.push({
    name: name,
    type: type,
    googleId: fileId,
    version: "v1.0",
    important: false,
    tags: tags,
    preview: preview
  });
  
  localStorage.setItem("files", JSON.stringify(customFiles));
  
  // Felder zur√ºcksetzen
  document.getElementById("fname").value = "";
  document.getElementById("gid").value = "";
  document.getElementById("ftags").value = "";
  document.getElementById("fpreview").checked = false;
  
  renderFiles();
}

// Audio Funktionen
function toggleAudio(button) {
  const audio = button.parentElement.querySelector('audio');
  if(audio.paused) {
    audio.play();
    button.textContent = '‚è∏Ô∏è Pause';
  } else {
    audio.pause();
    button.textContent = '‚ñ∂Ô∏è Play';
  }
}

function updateTime(audio) {
  const container = audio.closest('.audio-player');
  const timeDisplay = container.querySelector('.time-display');
  if(timeDisplay) {
    const current = formatTime(audio.currentTime);
    const duration = formatTime(audio.duration || 0);
    timeDisplay.textContent = `${current} / ${duration}`;
  }
}

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
}

// Design Einstellungen
const presets = [
  {bg:"#0f0f0f", text:"#ffffff", accent:"#ff2d2d", font:"Arial, sans-serif", fsize:15},
  {bg:"#f0f0f0", text:"#000000", accent:"#3498db", font:"Verdana, sans-serif", fsize:15},
  {bg:"#001f00", text:"#ffffff", accent:"#2ecc71", font:"Georgia, serif", fsize:16},
  {bg:"#1a001a", text:"#ffffff", accent:"#9b59b6", font:"Courier New, monospace", fsize:16}
];

function applyStyle(bg, text, accent, font, fsize) {
  document.documentElement.style.setProperty("--bg", bg);
  document.documentElement.style.setProperty("--text", text);
  document.documentElement.style.setProperty("--accent", accent);
  document.body.style.fontFamily = font;
  document.body.style.fontSize = fsize + "px";
  localStorage.setItem("bgColor", bg);
  localStorage.setItem("textColor", text);
  localStorage.setItem("accentColor", accent);
  localStorage.setItem("fontFamily", font);
  localStorage.setItem("fontSize", fsize);
}

// Event Listener f√ºr Design-√Ñnderungen
document.getElementById("bgColor").oninput = (e) => applyStyle(e.target.value, document.getElementById("textColor").value, document.getElementById("accentColor").value, document.getElementById("fontSelect").value, document.getElementById("fontSize").value);
document.getElementById("textColor").oninput = (e) => applyStyle(document.getElementById("bgColor").value, e.target.value, document.getElementById("accentColor").value, document.getElementById("fontSelect").value, document.getElementById("fontSize").value);
document.getElementById("accentColor").oninput = (e) => applyStyle(document.getElementById("bgColor").value, document.getElementById("textColor").value, e.target.value, document.getElementById("fontSelect").value, document.getElementById("fontSize").value);
document.getElementById("fontSelect").onchange = (e) => applyStyle(document.getElementById("bgColor").value, document.getElementById("textColor").value, document.getElementById("accentColor").value, e.target.value, document.getElementById("fontSize").value);
document.getElementById("fontSize").oninput = (e) => applyStyle(document.getElementById("bgColor").value, document.getElementById("textColor").value, document.getElementById("accentColor").value, document.getElementById("fontSelect").value, e.target.value);

document.getElementById("presetDesigns").onchange = function(e) {
  const p = presets[e.target.value];
  applyStyle(p.bg, p.text, p.accent, p.font, p.fsize);
};

function toggleTheme() {
  const currentBg = getComputedStyle(document.documentElement).getPropertyValue("--bg").trim();
  if(currentBg === "#0f0f0f") {
    applyStyle("#f0f0f0", "#000000", "#3498db", "Verdana, sans-serif", 15);
    document.getElementById("presetDesigns").value = "1";
  } else {
    applyStyle("#0f0f0f", "#ffffff", "#ff2d2d", "Arial, sans-serif", 15);
    document.getElementById("presetDesigns").value = "0";
  }
}

// Beim Laden Design laden
window.onload = function() {
  applyStyle(
    localStorage.getItem("bgColor") || "#0f0f0f",
    localStorage.getItem("textColor") || "#ffffff",
    localStorage.getItem("accentColor") || "#ff2d2d",
    localStorage.getItem("fontFamily") || "Arial, sans-serif",
    localStorage.getItem("fontSize") || 15
  );
  
  // Admin-Panel anzeigen wenn eingeloggt
  if(localStorage.getItem("isAdmin") === "true") {
    document.getElementById("adminPanel").style.display = "block";
  }
  
  renderFiles();
};
</script>
</body>
</html>